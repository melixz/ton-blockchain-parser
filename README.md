# TON Blockchain Parser

Этот проект является мини-парсером для блокчейна TON, использующим библиотеку `pytoniq`. Он получает последние блоки, обрабатывает новые транзакции и сохраняет все адреса в базу данных PostgreSQL для дальнейшей обработки. Также проект включает воркер для обработки адресов и экспорта данных в формате JSON.

## Установка

1. Клонируйте репозиторий:
    ```sh
    git clone https://github.com/melixz/ton-blockchain-parser.git
    cd ton-blockchain-parser
    ```

2. Установите необходимые зависимости:
    ```sh
    pip install -r requirements.txt
    ```

3. Создайте файл `.env` в корневой папке проекта и добавьте параметры подключения к базе данных PostgreSQL:
    ```env
    DB_USER=your_username
    DB_PASSWORD=your_password
    DB_HOST=localhost
    DB_PORT=5432
    DB_NAME=your_database
    ```

## Настройка

1. Убедитесь, что файл `.env` заполнен корректными значениями для подключения к базе данных PostgreSQL.

2. Запустите основной скрипт:
    ```sh
    python main.py
    ```

## Файлы проекта

- **`main.py`**: Основной файл, запускающий сканирование блоков и обработку адресов.
- **`db.py`**: Содержит функции для инициализации базы данных и получения пула соединений.
- **`block_scanner.py`**: Класс для сканирования блоков.
- **`handle_block.py`**: Функция для обработки блоков и извлечения транзакций.
- **`worker.py`**: Воркер для периодической обработки адресов.
- **`exporter.py`**: Скрипт для экспорта данных из базы данных в формат JSON.
- **`config.py`**: Конфигурация проекта, загружающая параметры из файла `.env`.

## Как это работает

1. **Инициализация базы данных**:
    - Скрипт создает таблицу `addresses`, если она еще не существует.

2. **Сканирование блоков**:
    - `BlockScanner` в бесконечном цикле получает последний блок из блокчейна и передает его функции `handle_block`.

3. **Обработка блоков**:
    - Функция `handle_block` извлекает транзакции из блока и сохраняет адреса в базу данных с флагом `status=0`.

4. **Обработка адресов**:
    - Воркер `address_worker` периодически проверяет базу данных на наличие адресов со статусом `0`, запрашивает код и данные смарт-контрактов для этих адресов и обновляет их статус и время изменения.

## Экспорт данных

Для экспорта данных из базы данных в формат JSON запустите скрипт:
```sh
python exporter.py
```
